const config={simulateMobileTap:!1,mobileTapRotateAmount:1,blobFresnelColour:16728584,blobFresnelAmount1:.27,blobFresnelAmount2:.47,blobFresnelAmount3:1.07,blobFresnelAmount4:.19,initialFov:92,cameraDist:4,selectedDist:.6,showLightHelpers:!1},hasHover=window.matchMedia("(hover: hover)").matches,renderer=new THREE.WebGLRenderer({alpha:!0,canvas:document.getElementById("threeCanvas")});renderer.setPixelRatio(2*window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(16777215,0);const camera=new THREE.PerspectiveCamera(config.initialFov,window.innerWidth/window.innerHeight,.01,1e3);camera.position.z=Math.sqrt(config.cameraDist*config.cameraDist/2),camera.position.y=Math.sqrt(config.cameraDist*config.cameraDist/2),camera.lookAt(0,0,0);const group=new THREE.Object3D,objects=[],clickables=[],blobs=[],scene=new THREE.Scene;scene.add(group);const controls=new THREE.ObjectControls(group,renderer.domElement,hasHover),directionalLight1=new THREE.DirectionalLight(16777215,1),directionalLight2=new THREE.DirectionalLight(16777215,1),directionalLight3=new THREE.DirectionalLight(16777215,1),directionalLight4=new THREE.DirectionalLight(16777215,1);var directionalLightHelper1,directionalLightHelper2,directionalLightHelper3,directionalLightHelper4,blobMaterial=fresnelMaterial();const hemiLight=new THREE.HemisphereLight(16777215,0,.8),objLoader=new THREE.OBJLoader,fbxLoader=new THREE.FBXLoader,textureLoader=new THREE.TextureLoader;var video,videoTexture,videoMaterial,videoObj;const mouse=new THREE.Vector2(-100,-100),raycaster=new THREE.Raycaster;var selectedObj,hoverObj,hoverObjPosition0=new THREE.Vector3,clickBusy=!1;const clock=new THREE.Clock;function initLightHelpers(){directionalLightHelper1=new THREE.DirectionalLightHelper(directionalLight1,1,"purple"),directionalLightHelper2=new THREE.DirectionalLightHelper(directionalLight2,1,"blue"),directionalLightHelper3=new THREE.DirectionalLightHelper(directionalLight3,1,"red"),directionalLightHelper4=new THREE.DirectionalLightHelper(directionalLight4,1,"green"),scene.add(directionalLightHelper1),scene.add(directionalLightHelper2),scene.add(directionalLightHelper3),scene.add(directionalLightHelper4),config.showLightHelpers=!0}function disposeLightHelpers(){directionalLightHelper1&&(directionalLightHelper1.dispose(),scene.remove(directionalLightHelper1)),directionalLightHelper2&&(directionalLightHelper2.dispose(),scene.remove(directionalLightHelper2)),directionalLightHelper3&&(directionalLightHelper3.dispose(),scene.remove(directionalLightHelper3)),directionalLightHelper4&&(directionalLightHelper4.dispose(),scene.remove(directionalLightHelper4)),config.showLightHelpers=!1}function initLights(){directionalLight1.position.set(0,2.5,3.9),directionalLight2.position.set(4,1,-4),directionalLight3.position.set(-4,1,-4),directionalLight4.position.set(0,-4,0),scene.add(directionalLight1),scene.add(directionalLight2),scene.add(directionalLight3),scene.add(directionalLight4)}function initFloor(){const e=textureLoader.load("/sda/assets/scenes/scene-1/tiles.png");e.anisotrophy=8,e.minFilter=THREE.LinearFilter,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.repeat=new THREE.Vector2(6,6);const t=new THREE.MeshBasicMaterial({map:e,side:THREE.DoubleSide}),i=new THREE.PlaneGeometry(6,6);i.rotateX(Math.PI/2),i.translate(0,-2,0);const n=new THREE.Mesh(i,t);scene.add(n),group.add(n),objects.push(n);const o=new THREE.GridHelper(6,6,0,0);o.position.y=-2.1,scene.add(o),group.add(o),objects.push(o)}function onResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onMouseMove(e){mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1}function applyFadeToAllExcept(e){document.getElementById("canvasBg").classList.add("faded");for(let t of objects)if(t!==e)if(Array.isArray(t.material))for(let e of t.material){e.transparent=!0;new TWEEN.Tween(e).to({opacity:.25},500).easing(TWEEN.Easing.Quadratic.InOut).start()}else{t.material.transparent=!0;new TWEEN.Tween(t.material).to({opacity:.25},500).easing(TWEEN.Easing.Quadratic.InOut).start()}}function removeFadeFromAll(){document.getElementById("canvasBg").classList.remove("faded");for(let e of objects)if(Array.isArray(e.material))for(let t of e.material){t.opacity=1;new TWEEN.Tween(t).to({opacity:1},500).easing(TWEEN.Easing.Quadratic.InOut).start()}else{e.material.opacity=1;new TWEEN.Tween(e.material).to({opacity:1},500).easing(TWEEN.Easing.Quadratic.InOut).start()}}function handleImgClicked(e){selectedObj=e,scene.attach(e),e.selected=!0,selectedObj.bringToFocus(camera,config.selectedDist),applyFadeToAllExcept(selectedObj)}function putSelectedBack(){group.attach(selectedObj),selectedObj.putSelectedBack(700),removeFadeFromAll(),selectedObj=null}function handleClick(){if(!clickBusy)if(setTimeout((function(){clickBusy=!1}),200),clickBusy=!0,selectedObj)putSelectedBack();else if(clickables.length>0){const e=raycaster.intersectObjects(clickables);e.length>0&&handleImgClicked(e[0].object)}}function animate(){videoTexture&&videoTexture.update(),controls.update(clock.getDelta()),selectedObj&&animateSelectedObj()}function animateSelectedObj(){}function handleRaycast(){if(raycaster.setFromCamera(mouse,camera),!this.selectedObj&&clickables.length>0){const e=raycaster.intersectObjects(clickables);if(e.length>0){renderer.domElement.style.cursor="pointer",controls.mouseBusy=!0;for(let t of clickables)e[0].object!=t||t.tweening||t.selected?(t.hovered=!1,!t.up||t.tweening||t.selected||t.putBack()):(t.hovered=!0,t.liftUp())}else{controls.mouseBusy=!1;for(let e of clickables)e.hovered=!1,!e.up||e.tweening||e.selected||e.putBack()}}}function render(){animate(),renderer.render(scene,camera),TWEEN.update(),requestAnimationFrame(render),hasHover&&handleRaycast()}function handleTouchStart(){giveUsASpin()}function addEvents(){renderer.domElement.addEventListener("resize",onResize,!1),hasHover?(renderer.domElement.addEventListener("mousemove",onMouseMove,!1),renderer.domElement.addEventListener("mousedown",handleClick,!1)):renderer.domElement.addEventListener("touchstart",handleTouchStart,!1)}function configLoadingManager(){THREE.DefaultLoadingManager.onStart=function(e,t,i){console.log("Started loading file: "+e+".\nLoaded "+t+" of "+i+" files.")},THREE.DefaultLoadingManager.onLoad=function(){console.log("Loading Complete!"),document.getElementById("threeCanvas").style.opacity=1;let e=document.getElementById("loader");e.style.opacity=0,setTimeout((function(){e.remove()}),2e3)},THREE.DefaultLoadingManager.onProgress=function(e,t,i){console.log("Loading file: "+e+".\nLoaded "+t+" of "+i+" files.")},THREE.DefaultLoadingManager.onError=function(e){console.log("There was an error loading "+e)}}function addObj(e,t){objLoader.load(e,(function(e){e.traverse((function(e){e instanceof THREE.Mesh&&t(e)}))}),(function(e){}),(function(e){console.log(e)}))}function addFbx(e,t){fbxLoader.load(e,(function(e){e.traverse((function(e){e instanceof THREE.Mesh&&t(e)}))}),(function(e){}),(function(e){console.log(e)}))}function addImage(e,t){try{const i=new THREE.MeshBasicMaterial;i.map=textureLoader.load(e);const n=new THREE.MeshBasicMaterial({color:0,transparent:!0,opacity:0}),o=[n,n,n,n,i,i],a=new Image;a.onload=()=>{const e=a.height/a.width,i=new THREE.BoxGeometry(1,1*e,1e-4),n=new ImageMesh(i,o);t(n)},a.src=e}catch(e){console.log(e)}}function giveUsASpin(){const e=new TWEEN.Tween(controls).to({autoSpeed:3*config.mobileTapRotateAmount},100).easing(TWEEN.Easing.Quadratic.In).onComplete((()=>{t.start()})),t=new TWEEN.Tween(controls).to({autoSpeed:.1},2e3*config.mobileTapRotateAmount).easing(TWEEN.Easing.Quadratic.Out).onComplete((()=>{}));e.start()}function spinIn(){const e=new TWEEN.Tween(controls).to({autoSpeed:15},100).easing(TWEEN.Easing.Quadratic.In).onComplete((()=>{t.start()})),t=new TWEEN.Tween(controls).to({autoSpeed:.1},2e3).easing(TWEEN.Easing.Quadratic.Out).onComplete((()=>{}));e.start();new TWEEN.Tween(group.scale).to({x:1,y:1,z:1},2e3).easing(TWEEN.Easing.Quadratic.Out).onComplete((()=>{})).start(),e.start()}function handleBlobColourChange(){for(let e of blobs)blobMaterial=fresnelMaterial(config.blobFresnelColour,config.blobFresnelAmount1,config.blobFresnelAmount2,config.blobFresnelAmount3,config.blobFresnelAmount4),e.material=blobMaterial}function handleUpdateCameraMatrix(){camera.updateProjectionMatrix()}function handleUpdateCameraDist(){camera.position.z=Math.sqrt(config.cameraDist*config.cameraDist/2),camera.position.y=Math.sqrt(config.cameraDist*config.cameraDist/2),camera.lookAt(0,0,0),handleUpdateCameraMatrix()}function handleSelectedDistUpdate(){selectedObj&&(selectedObj.position.y=camera.position.y-config.selectedDist,selectedObj.position.z=camera.position.z-config.selectedDist)}function handleToggleLightHelpers(){config.showLightHelpers?initLightHelpers():disposeLightHelpers()}function initGUI(){controlsGUI.add(controls,"autoSpeed",-1,1,.05).name("Auto Rotate Speed"),controlsGUI.add(controls,"rotationSpeed",0,.1,.01).name("Drag Rotate Speed"),controlsGUI.add(config,"mobileTapRotateAmount",0,3,.1).name("Mobile Tap Speed"),viewContraintsGUI=controlsGUI.addFolder("View Angle Contraints"),viewContraintsGUI.add(controls.maxRotationAngles.x,"from",Math.PI/4,Math.PI,.01).name("Min Angle"),viewContraintsGUI.add(controls.maxRotationAngles.x,"to",0,Math.PI,.01).name("Max Angle"),controlsGUI.add(config,"simulateMobileTap").onChange(giveUsASpin).name("Simulate Mobile Tap"),colourGUI.addColor(config,"blobFresnelColour").onChange(handleBlobColourChange).name("Fresnel Colour"),colourGUI.add(config,"blobFresnelAmount1",0,2,.01).onChange(handleBlobColourChange).name("Fresel Mod 1"),colourGUI.add(config,"blobFresnelAmount2",0,2,.01).onChange(handleBlobColourChange).name("Fresel Mod 2"),colourGUI.add(config,"blobFresnelAmount3",0,2,.01).onChange(handleBlobColourChange).name("Fresel Mod 3"),colourGUI.add(config,"blobFresnelAmount4",0,2,.01).onChange(handleBlobColourChange).name("Fresel Mod 4"),cameraGUI.add(camera,"fov",0,150,1).onChange(handleUpdateCameraMatrix).name("FOV"),cameraGUI.add(config,"cameraDist",1,20,.1).onChange(handleUpdateCameraDist).name("Camera Dist"),cameraGUI.add(config,"selectedDist",0,5,.1).onChange(handleSelectedDistUpdate).name("Selected Obj Dist"),lightsGUI.add(config,"showLightHelpers").onChange(handleToggleLightHelpers).name("Show Light Helpers"),directionalLight1GUI=lightsGUI.addFolder("Directional Light 1"),directionalLight1GUI.add(directionalLight1,"intensity",0,1,.1).name("Intensity"),directionalLight1GUI.add(directionalLight1.position,"x",-3,3,.1).name("X position"),directionalLight1GUI.add(directionalLight1.position,"y",0,8,.1).name("Y position"),directionalLight1GUI.add(directionalLight1.position,"z",0,10,.1).name("Z position"),directionalLight2GUI=lightsGUI.addFolder("Directional Light 2"),directionalLight2GUI.add(directionalLight2,"intensity",0,1,.1).name("Intensity"),directionalLight2GUI.add(directionalLight2.position,"x",0,8,.1).name("X position"),directionalLight2GUI.add(directionalLight2.position,"y",0,8,.1).name("Y position"),directionalLight2GUI.add(directionalLight2.position,"z",-10,0,.1).name("Z position"),directionalLight3GUI=lightsGUI.addFolder("Directional Light 3"),directionalLight3GUI.add(directionalLight3,"intensity",0,1,.1),directionalLight3GUI.add(directionalLight3.position,"x",-8,0,.1),directionalLight3GUI.add(directionalLight3.position,"y",0,8,.1),directionalLight3GUI.add(directionalLight3.position,"z",-10,0,.1),directionalLight4GUI=lightsGUI.addFolder("Directional Light 4"),directionalLight4GUI.add(directionalLight4,"intensity",0,1,.1),directionalLight4GUI.add(directionalLight4.position,"x",-8,0,.1),directionalLight4GUI.add(directionalLight4.position,"y",0,8,.1),directionalLight4GUI.add(directionalLight4.position,"z",-10,0,.1)}function initImages(){addImage("/sda/assets/scenes/scene-1/sceneImg1.jpg",(function(e){e.scale.set(2.3,2.3,2.3),e.position.set(-1.7,-.3,-1.7),e.position0.copy(e.position),e.rotateY(Math.PI/4),e.rotation0.copy(e.rotation),e.quaternion0.copy(e.quaternion),e.scale0.copy(e.scale),group.add(e),objects.push(e),clickables.push(e)})),addImage("/sda/assets/scenes/scene-1/sceneImg3.jpg",(function(e){e.scale.set(2.3,2.3,2.3),e.position.set(1.7,-.3,-1.7),e.position0.copy(e.position),e.rotateY(-Math.PI/4),e.rotation0.copy(e.rotation),e.quaternion0.copy(e.quaternion),e.scale0.copy(e.scale),group.add(e),objects.push(e),clickables.push(e)})),addImage("/sda/assets/scenes/scene-1/sceneImg4.jpg",(function(e){e.scale.set(2.3,2.3,2.3),e.position.set(-1.7,-.3,1.7),e.position0.copy(e.position),e.rotateY(-Math.PI/4),e.rotation0.copy(e.rotation),e.quaternion0.copy(e.quaternion),e.scale0.copy(e.scale),group.add(e),objects.push(e),clickables.push(e)})),addImage("/sda/assets/scenes/scene-1/sceneImg5.jpg",(function(e){e.scale.set(2.3,2.3,2.3),e.position.set(1.7,-.3,1.7),e.position0.copy(e.position),e.rotateY(Math.PI/4),e.rotation0.copy(e.rotation),e.quaternion0.copy(e.quaternion),e.scale0.copy(e.scale),group.add(e),objects.push(e),clickables.push(e)})),addImage("/sda/assets/scenes/scene-1/sceneImg2.jpg",(function(e){e.scale.set(2.7,2.7,2.7),e.position.set(0,0,0),e.position0.copy(e.position),e.rotation0.copy(e.rotation),e.quaternion0.copy(e.quaternion),e.scale0.copy(e.scale),e.rotateY(Math.PI/4),group.add(e),objects.push(e),clickables.push(e)})),addFbx("/sda/assets/scenes/scene-1/blobsOnly2.fbx",(function(e){e.material=blobMaterial,e.scale.set(.25,.25,.25),e.position.y-=2,group.add(e),objects.push(e),blobs.push(e)}))}function initGroup(){group.scale.set(.05,.05,.05)}function init(){initGroup(),initLights(),initFloor(),initImages(),addEvents(),configLoadingManager(),render(),spinIn()}init();